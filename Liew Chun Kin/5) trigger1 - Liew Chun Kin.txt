SET SERVEROUTPUT ON;
alter SESSION set NLS_DATE_FORMAT = 'DD/MM/YYYY';

DROP SEQUENCE custIDSeq;

CREATE SEQUENCE custIDSeq
	INCREMENT BY 1
	START WITH 0021
	NOCACHE
	NOCYCLE;

CREATE OR REPLACE FUNCTION GET_IC_LAST_DIGIT(V_ICNUMBER IN VARCHAR2)
RETURN BOOLEAN IS

BEGIN
   IF(MOD(TO_NUMBER(SUBSTR(V_ICNUMBER,-1),'9'),2)=0) THEN
      RETURN TRUE;

   ELSE
      RETURN FALSE;
   END IF;

 EXCEPTION
    WHEN OTHERS THEN
       RETURN FALSE;
END;
/

CREATE OR REPLACE TRIGGER TRG_AUTO_GENDER_AND_CHK_AGE
BEFORE INSERT ON CUSTOMER
FOR EACH ROW

DECLARE

V_ICNUMBER CUSTOMER.CUST_IC%TYPE;

BEGIN
 V_ICNUMBER := :NEW.CUST_IC;

 IF(GET_IC_LAST_DIGIT(V_ICNUMBER) = TRUE) THEN
 :NEW.CUST_GENDER := 'F';
 ELSE
 :NEW.CUST_GENDER := 'M';
 END IF;

 IF (MONTHS_BETWEEN(SYSDATE,:NEW.CUST_DOB)/12) < 18 THEN
		RAISE_APPLICATION_ERROR(-20110, 'UNDER AGE 18');
 END IF;

END;
/

/* 
   select * from customer;
   insert into customer (cust_id, cust_fname, cust_lname, cust_hp, cust_email, cust_dob, cust_ic) values ('C'||lpad(custIDSeq.nextval, 4, '0'), 'Liew', 'Chun Kin', '0169893528', 'chunkinliew0524@gmail.com', '24/05/2001', '010524100379'); 
*/